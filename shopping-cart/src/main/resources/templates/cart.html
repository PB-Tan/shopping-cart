<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping Cart</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      .page-wrap {
        padding: 2rem 1rem;
      }
      .table thead th {
        white-space: nowrap;
      }
      .qty-input {
        max-width: 110px;
      }
      .btn-icon {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
      }
      .cart-summary {
        position: sticky;
        top: 1rem;
      }
      .price-col,
      .total-col {
        text-align: right;
      }
      .product-name {
        font-weight: 600;
      }
      .product-img {
        width: 70px;
        height: 70px;
        object-fit: cover;
        border-radius: 0.25rem;
      }
      @media (max-width: 991.98px) {
        .cart-summary {
          position: static;
        }
      }
    </style>
  </head>

  <body>
    <div th:replace="~{fragments/layout :: siteHeader}"></div>
    <div class="container page-wrap">
      <div class="d-flex align-items-center mb-3">
        <h1 class="h3 mb-0">Your Cart</h1>
        <form th:action="@{/cart/clear}" method="post" class="ml-auto">
          <button type="submit" class="btn btn-outline-danger btn-sm">
            Clear cart
          </button>
        </form>
      </div>

      <div class="row">
        <!-- Items table -->
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                  <thead class="thead-light">
                    <tr>
                      <th>Image</th>
                      <th>Product</th>
                      <th class="price-col">Price ($)</th>
                      <th>Status</th>
                      <th>Quantity</th>
                      <th class="text-center">Remove</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="ci : ${items}">
                      <td>
                        <img
                          class="product-img"
                          th:src="${ci.product.imageUrl}"
                          alt="product"
                        />
                      </td>

                      <td class="align-middle">
                        <div
                          class="product-name"
                          th:text="${ci.product.name}"
                        ></div>
                        <small
                          class="text-muted"
                          th:text="'SKU: ' + ${ci.product.id}"
                        ></small>
                      </td>

                      <td
                        class="align-middle price-col"
                        th:text="${ci.product.unitPrice}"
                      ></td>

                      <td class="align-middle" th:switch="${true}">
                        <!-- Insufficient -->
                        <span
                          th:case="${ci.product.stock - ci.quantity < 0}"
                          class="badge badge-danger"
                          th:utext="'Insufficient Stock<br/> Qty ≤ ' + ${ci.product.stock}"
                        >
                        </span>
                        <!-- Limited -->
                        <span
                          th:case="${ci.product.stock - ci.quantity <= 5}"
                          class="badge badge-warning text-dark"
                          >Limited Stock</span
                        >
                        <!-- Available -->
                        <span th:case="*" class="badge badge-success"
                          >Available</span
                        >
                      </td>

                      <td class="align-middle">
                        <form
                          th:action="@{/cart/update}"
                          method="post"
                          class="form-inline"
                        >
                          <input
                            type="hidden"
                            name="productId"
                            th:value="${ci.product.id}"
                          />
                          <div class="input-group qty-input">
                            <input
                              type="number"
                              class="form-control form-control-sm"
                              name="quantity"
                              min="1"
                              th:attr="max=${ci.product.stock}"
                              th:value="${ci.quantity}"
                            />
                            <div class="input-group-append">
                              <button
                                type="submit"
                                class="btn btn-outline-primary btn-sm"
                              >
                                Update
                              </button>
                            </div>
                          </div>
                        </form>
                      </td>

                      <td class="align-middle text-center">
                        <form
                          th:action="@{/cart/remove}"
                          method="post"
                          class="d-inline"
                        >
                          <input
                            type="hidden"
                            name="productId"
                            th:value="${ci.product.id}"
                          />
                          <button
                            type="submit"
                            class="btn btn-outline-secondary btn-icon"
                            title="Remove"
                          >
                            Remove
                          </button>
                        </form>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Summary / Checkout -->
        <div class="col-lg-4 mt-3 mt-lg-0">
          <div class="card shadow-sm cart-summary">
            <div class="card-header bg-white">
              <strong>Cart Total</strong>
            </div>
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <span>Subtotal</span>
                <span class="font-weight-bold" th:text="${subtotal}">0.00</span>
              </div>
              <form
                th:action="@{/checkout/discountCode}"
                method="post"
                class="mb-2"
              >
                <label for="discountCode" class="sr-only">Discount Code</label>
                <div class="input-group">
                  <input
                    id="discountCode"
                    name="code"
                    type="text"
                    class="form-control"
                    placeholder="Discount code"
                  />
                  <div class="input-group-append">
                    <button class="btn btn-outline-primary" type="submit">
                      Apply Code
                    </button>
                  </div>
                </div>
                <small class="form-text text-muted">One code per order.</small>
                <div
                  class="alert alert-danger py-1 px-2 mt-2 mb-0"
                  th:if="${invalidCode}"
                  th:text="${invalidCode}"
                ></div>
                <div
                  class="alert alert-success py-1 px-2 mt-2 mb-0"
                  th:if="${codeApplied}"
                  th:text="${codeApplied}"
                ></div>
              </form>

              <hr />

              <form th:action="@{/checkout}" method="get">
                <!-- <div class="form-group mb-2">
                  <label class="mb-1">Shipping</label>
                  <div class="custom-control custom-radio">
                    <input
                      class="custom-control-input"
                      type="radio"
                      id="shipFlat"
                      name="delivery"
                      value="flatRate"
                    />
                    <label class="custom-control-label" for="shipFlat"
                      >Flat Rate of S$7.00</label
                    >
                  </div>
                  <div class="custom-control custom-radio">
                    <input
                      class="custom-control-input"
                      type="radio"
                      id="shipSelf"
                      name="delivery"
                      value="selfCollect"
                    />
                    <label class="custom-control-label" for="shipSelf"
                      >Self-collect</label
                    >
                  </div>
                </div> -->

                <div class="d-flex justify-content-between total-col mt-3">
                  <span>Total</span>
                  <!-- Keep using subtotal if you’re computing shipping server-side -->
                  <span class="h5 mb-0" th:text="${subtotal}">0.00</span>
                </div>
                <!-- Clicking this redirects to checkoutpage -->
                <button type="submit" class="btn btn-primary btn-block mt-3">
                  Proceed to Checkout
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
